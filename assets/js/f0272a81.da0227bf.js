"use strict";(self.webpackChunkphpvms_docs=self.webpackChunkphpvms_docs||[]).push([[3154],{1064:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"acars/customizing/rules","title":"Custom Rules","description":"For users with Premium, you can create their own rules, in Javascript. See Custom Packaging on how to create a distribution for your VA, which can include rules, sounds and callbacks.","source":"@site/docs/acars/customizing/rules.md","sourceDirName":"acars/customizing","slug":"/acars/customizing/rules","permalink":"/acars/customizing/rules","draft":false,"unlisted":false,"editUrl":"https://github.com/phpvms/docs/tree/master/docs/acars/customizing/rules.md","tags":[],"version":"current","frontMatter":{"id":"rules","title":"Custom Rules"},"sidebar":"docs","previous":{"title":"Aircraft Configs","permalink":"/acars/customizing/aircraftconfigs"},"next":{"title":"Plugin Tutorial","permalink":"/acars/customizing/tutorial"}}');var r=t(4848),a=t(8453);const o={id:"rules",title:"Custom Rules"},i=void 0,c={},l=[{value:"Testing",id:"testing",level:2}];function d(e){const s={a:"a",admonition:"admonition",code:"code",h2:"h2",hr:"hr",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.p,{children:["For users with Premium, you can create their own rules, in Javascript. See ",(0,r.jsx)(s.a,{href:"./packaging.md",children:"Custom Packaging"})," on how to create a distribution for your VA, which can include rules, sounds and callbacks."]}),"\n",(0,r.jsxs)(s.p,{children:["See the documentation at the ",(0,r.jsx)(s.a,{href:"https://github.com/phpvms/acars-pdk",children:"acars-pdk repository"})," on how to create aircraft configs, rules, and package them for distribution"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"testing",children:"Testing"}),"\n",(0,r.jsx)(s.p,{children:"What I do is create a tests folder, so it looks like this:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"rules/\n  tests/\n    lights.test.js  < will be created below\n  lights.js\n  package.json < will created below\nmanifest.json\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Create a ",(0,r.jsx)(s.code,{children:"package.json"})," file in the root of the ",(0,r.jsx)(s.code,{children:"rules"})," folder, so it looks like:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'{\n  "name": "VA Rules",\n  "version": "1.0.0",\n  "author": "Your Name",\n  "type": "module",\n  "scripts": {\n    "tests": "tap"\n  }\n}\n'})}),"\n",(0,r.jsxs)(s.p,{children:["Next, grab the ",(0,r.jsx)(s.code,{children:"mocks.js"})," file from here. This is used to mock the methods that ACARS provides, so that in the tests, there are faked versions available. If you cloned the sample repository, this file is already there."]}),"\n",(0,r.jsxs)(s.p,{children:["Then, install ",(0,r.jsx)(s.a,{href:"https://node-tap.org",children:"tap"})," using:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"npm install --save-dev tap\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Next, create a ",(0,r.jsx)(s.code,{children:"tests/lights.test.js"}),". The example shown above is the ",(0,r.jsx)(s.code,{children:"Rule"})," class that's being assumed to be used. The important parts are commented:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-js",children:"import t from 'tap'\nimport * as Lights from '../lights.js'\nimport {createMocks} from \"./mocks.js\"\n\nt.before(createMocks)\n\nt.test('Test the lights function', t => {\n    const rule = new Lights.Rule()\n    // You can pass the data that is only relevent to your rule here in the PIREP and Data objects\n    t.equal(rule.evaluate({}, {}), 0)\n    t.end()\n})\n"})}),"\n",(0,r.jsx)(s.admonition,{type:"note",children:(0,r.jsx)(s.p,{children:"You can use webpack and babel to create a smaller distribution, which you can then create a packaged, minimized build, which then can be used by ACARS. So you're welcome to create your rules using Typescript and transpile them."})}),"\n",(0,r.jsx)(s.p,{children:"Then you can finally run your tests:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"cd rules\nnpm run tests\n"})}),"\n",(0,r.jsx)(s.admonition,{type:"note",children:(0,r.jsxs)(s.p,{children:["You can use ",(0,r.jsx)(s.a,{href:"https://node-tap.org/plugins/clock",children:"the clock plugin"})," to fast forward time - call your rule, advance the clock, call it again and check for violations"]})})]})}function u(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,s,t)=>{t.d(s,{R:()=>o,x:()=>i});var n=t(6540);const r={},a=n.createContext(r);function o(e){const s=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),n.createElement(a.Provider,{value:s},e.children)}}}]);